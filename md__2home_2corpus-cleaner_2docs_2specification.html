<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Corpus Cleaner: Specification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Corpus Cleaner
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Specification</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Contents</h1>
<ul>
<li>Contents</li>
<li>Folder Structure</li>
<li>File Format</li>
<li>Corpus Cleaner Feature</li>
<li>MultiProcess Cleaning</li>
<li>Test</li>
<li>Documentation</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Folder Structure</h1>
<p>This tool assumes the following folder structure.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Input Structure</h2>
<p>Please place the dataset files to "/results/dataset/original/".</p>
<p>Example:</p>
<div class="fragment"><div class="line">corpus-cleaner</div>
<div class="line">|-- results</div>
<div class="line">|   `-- dataset</div>
<div class="line">|         `-- original</div>
<div class="line">|             |-- sample_dataset_train.txt   # This file is to be cleaned.</div>
<div class="line">|             `-- sample_dataset_test.txt    # This file is to be cleaned.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Intermediate Structure</h2>
<p>The contents of each number folder are as follows. <br  />
 After running this tool, the files in the "results/dataset/original" folder will be divided into multiple parts (in the example below, 8 parts from 0 to 7) and each will be copied to the "dataset/i/input" folder. <br  />
</p>
<div class="fragment"><div class="line">corpus-cleaner</div>
<div class="line">|-- results</div>
<div class="line">|   |-- dataset</div>
<div class="line">|         |-- 0</div>
<div class="line">|         |   |-- input</div>
<div class="line">|         |   `-- output</div>
<div class="line">|         |-- 1</div>
<div class="line">|         |   |-- input</div>
<div class="line">|         |   `-- output</div>
<div class="line">|       ~ ommit ~ </div>
<div class="line">|         |-- 7</div>
<div class="line">|         |   |-- input</div>
<div class="line">|         |   `-- output</div>
<div class="line">|         |-- cleaned</div>
<div class="line">|         `-- original</div>
</div><!-- fragment --><p>The breakdown of the numbered folders is as follows. <br  />
 First, the contents of the input folder are copied to the intermediate folder. <br  />
</p>
<div class="fragment"><div class="line">corpus-cleaner</div>
<div class="line">|-- results</div>
<div class="line">|   |-- dataset</div>
<div class="line">|         |-- 0</div>
<div class="line">|             |-- input</div>
<div class="line">|             |   |-- sample_dataset_train.txt</div>
<div class="line">|         ã€€ã€€|   `-- sample_dataset_test.txt   </div>
<div class="line">|             `-- output</div>
<div class="line">|                 |-- cleaned</div>
<div class="line">|                 |   `-- sample_dataset_train.jsonl</div>
<div class="line">|                 |-- exception</div>
<div class="line">|                 |   `-- exception.txt</div>
<div class="line">|                 |-- intermediate</div>
<div class="line">|                 |   |-- sample_dataset_train.txt</div>
<div class="line">|                 |   `-- sample_dataset_test.txt   </div>
<div class="line">|                 `-- rejected</div>
<div class="line">|                     `-- sample_dataset_train.jsonl</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Output Structure</h2>
<div class="fragment"><div class="line">corpus-cleaner</div>
<div class="line">|-- results</div>
<div class="line">|   |-- dataset</div>
<div class="line">|         |-- 0</div>
<div class="line">|         |   |-- input</div>
<div class="line">|         |   `-- output</div>
<div class="line">|         |-- 1</div>
<div class="line">|         |   |-- input</div>
<div class="line">|         |   `-- output</div>
<div class="line">|       ~ ommit ~ </div>
<div class="line">|         |-- 7</div>
<div class="line">|         |   |-- input</div>
<div class="line">|         |   `-- output</div>
<div class="line">|         |-- cleaned</div>
<div class="line">|         `-- original</div>
</div><!-- fragment --><p>Note that if the cleaned file already exists, processing after the constructor of the <a class="el" href="classCorpusCleaner.html">CorpusCleaner</a> class will not proceed to prevent it from being overwritten. <br  />
 The following warning appears on the console, so move or delete the relevant file to another directory, and then try the process again. <br  />
</p>
<div class="fragment"><div class="line">ERROR: output_path or rejected_path folder already exists. Please RENAME to delete the selection.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
File Format</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Input File</h2>
<p>This tool takes a .txt file as input. Each .txt file is expected to contain one data series per line. <br  />
 The each line format is following.</p>
<div class="fragment"><div class="line">æ±æ´‹å²(ã¨ã†ã‚ˆã†ã—)ã¯ã€æ±æ´‹ã‚’åºƒãæ‰±ã£ãŸæ­´å²ã§ã‚ã‚Šæ±æ´‹å­¦ã®æ­´å²åˆ†é‡ã®ã“ã¨ã§ã‚ã‚Šã€Œæ±æ´‹å²å­¦ã€(ã¨ã†ã‚ˆã†ã—ãŒã)ã¨ã‚‚ç§°ã•ã‚Œã‚‹ã€‚ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘èªã®ã€Œæ±æ´‹å²ã€(ãŸã¨ãˆã°è‹±èªã®ã€ŒOriental Historyã€)ã®è¨³èªã§ã‚ã‚Šã€ç¾åœ¨ã®æ—¥æœ¬èªã®æ…£ä¾‹ã§ã¯ãŠãŠã‚€ã­ãƒã‚°ãƒªãƒ–ã‹ã‚‰æ—¥æœ¬ã«ã‹ã‘ã¦ã®åŒ—ã‚¢ãƒ•ãƒªã‚«ã€ãƒ¦ãƒ¼ãƒ©ã‚·ã‚¢å¤§é™¸(ãŸã ã—ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘åœ°åŸŸã‚’é™¤ã)ãŠã‚ˆã³å‘¨è¾ºè«¸å³¶ã®æ­´å²ã‚’æ‰±ã†ã€‚</div>
<div class="line">è¶£å‘³ã¯ãƒã‚¤ã‚¯ã€‚MARVELã‚‚å¤§å¥½ãã§ã‚­ãƒ£ãƒ—ãƒ†ãƒ³ã‚¢ãƒ¡ãƒªã‚«ã¨åŒã˜ãƒãƒ¼ãƒ¬ãƒ¼ãƒ€ãƒ“ãƒƒãƒ‰ã‚½ãƒ³ã‚’æ‰€æœ‰ã—ã¦ã„ã‚‹ã€‚</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Output File</h2>
<p>This tool is output cleaned file that is jsonl format. <br  />
 The each line format is following. <br  />
</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;text&quot;:&quot; &lt;cleaned data&gt;&quot;,</div>
<div class="line">  &quot;id&quot;:&quot;&lt;original file name&gt;_&lt;the line number of original file&gt;&quot;,</div>
<div class="line">  &quot;is_rejected&quot;:&quot;&lt;0 or 1 (0: data that is to be remained, 1: data that is to be removed)&gt;&quot;,  </div>
<div class="line">  &quot;metadata&quot;:&quot;&lt;the function name list that processes tesxt&gt;&quot;,</div>
<div class="line">  &quot;language&quot;:&quot;&lt;language classification by fasttext. __label__ja is Japanese, __label__en is English, etc.&gt;&quot;,</div>
<div class="line">  &quot;language_score&quot;:&quot;&lt;language classification score by fasttext.&gt;&quot;,</div>
<div class="line">  &quot;perplexity&quot;:&quot;&lt;perplexity value by kenlm model.&gt;&quot;  </div>
<div class="line">}</div>
</div><!-- fragment --><p>Example:</p>
<div class="fragment"><div class="line">{&quot;text&quot;:&quot;æ±æ´‹å²(ã¨ã†ã‚ˆã†ã—)ã¯ã€æ±æ´‹ã‚’åºƒãæ‰±ã£ãŸæ­´å²ã§ã‚ã‚Šæ±æ´‹å­¦ã®æ­´å²åˆ†é‡ã®ã“ã¨ã§ã‚ã‚Šã€Œæ±æ´‹å²å­¦ã€(ã¨ã†ã‚ˆã†ã—ãŒã)ã¨ã‚‚ç§°ã•ã‚Œã‚‹ã€‚ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘èªã®ã€Œæ±æ´‹å²ã€(ãŸã¨ãˆã°è‹±èªã®ã€ŒOriental Historyã€)ã®è¨³èªã§ã‚ã‚Šã€ç¾åœ¨ã®æ—¥æœ¬èªã®æ…£ä¾‹ã§ã¯ãŠãŠã‚€ã­ãƒã‚°ãƒªãƒ–ã‹ã‚‰æ—¥æœ¬ã«ã‹ã‘ã¦ã®åŒ—ã‚¢ãƒ•ãƒªã‚«ã€ãƒ¦ãƒ¼ãƒ©ã‚·ã‚¢å¤§é™¸(ãŸã ã—ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘åœ°åŸŸã‚’é™¤ã)ãŠã‚ˆã³å‘¨è¾ºè«¸å³¶ã®æ­´å²ã‚’æ‰±ã†ã€‚&quot;,&quot;id&quot;:&quot;wiki_test_27&quot;,&quot;is_rejected&quot;:&quot;0&quot;,&quot;metadata&quot;:&quot;Normalizer,&quot;,&quot;language&quot;:&quot;__label__ja&quot;,&quot;language_score&quot;:&quot;0.999781&quot;,&quot;perplexity&quot;:&quot;6298.67&quot;}</div>
<div class="line">{&quot;text&quot;:&quot;è¶£å‘³ã¯ãƒã‚¤ã‚¯ã€‚MARVELã‚‚å¤§å¥½ãã§ã‚­ãƒ£ãƒ—ãƒ†ãƒ³ã‚¢ãƒ¡ãƒªã‚«ã¨åŒã˜ãƒãƒ¼ãƒ¬ãƒ¼ãƒ€ãƒ“ãƒƒãƒ‰ã‚½ãƒ³ã‚’æ‰€æœ‰ã—ã¦ã„ã‚‹ã€‚&quot;,&quot;id&quot;:&quot;wiki_test_2934&quot;,&quot;is_rejected&quot;:&quot;1&quot;,&quot;metadata&quot;:&quot;Normalizer,PerplexityFilter,&quot;,&quot;language&quot;:&quot;__label__ja&quot;,&quot;language_score&quot;:&quot;1.00005&quot;,&quot;perplexity&quot;:&quot;179648&quot;}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Corpus Cleaner Feature</h1>
<p>In this chapter, I explain corpus cleaner feature that is <a class="el" href="classCorpusCleaner.html">CorpusCleaner</a> class.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Flow</h2>
<p>TODO: write about <br  />
 TODO: write about using memory resource <br  />
</p>
<h2><a class="anchor" id="autotoc_md11"></a>
List of Filtering Feature</h2>
<p>For usage examples of each function, please refer to the API specifications. <br  />
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Features   </th><th class="markdownTableHeadLeft">Details   </th><th class="markdownTableHeadLeft">Remarks    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Normalizer   </td><td class="markdownTableBodyLeft">Perform the normalization process described in the <a href="https://github.com/neologd/mecab-ipadic-neologd/wiki/Regexp.ja">link</a> below. <br  />
 Neologdn's normalization contents include, for example, "replace half-width katakana with full-width" and "replace full-width spaces with half-width spaces."   </td><td class="markdownTableBodyLeft">See <a href="https://github.com/neologd/mecab-ipadic-neologd/wiki/Regexp.ja">here</a> for details on normalization contents.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">URLRemover   </td><td class="markdownTableBodyLeft">Remove URLs matching regular expression that is "(https?\|ftp)(:\/\/[-_\.!~*\'()a-zA-Z0-9;\/?:\@&amp;=\+\$,%#]+)".   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SpecialCharactersRemover   </td><td class="markdownTableBodyLeft">Remove special character.<br  />
 For example, â˜€, â™¡, â˜†, and so on.<br  />
Removes special characters within a specific Unicode range.   </td><td class="markdownTableBodyLeft">Please refer <a href="https://guppy.eng.kagawa-u.ac.jp/OpenCampus/unicode.html">this URL</a>.<br  />
Special characters to be removed include some emojis.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">EmojiRemover   </td><td class="markdownTableBodyLeft">Remove emoji characters that is \U0001F300(ğŸŒ€) to \U0001F9FF(ğŸ§¿).   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">QuotesRemover   </td><td class="markdownTableBodyLeft">Remove quotes. For example, [1], {245}, and so on.   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">LengthFilter   </td><td class="markdownTableBodyLeft">Remove too long sentence and too short sentence.   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">LanguageFilter   </td><td class="markdownTableBodyLeft">Classify sentence composition language and quality using fastText.<br  />
 This function is applied to japanese and english.   </td><td class="markdownTableBodyLeft">This function uses fastText. About fastText, please refer <a href="https://fasttext.cc/docs/en/crawl-vectors.html">here</a>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">MinhashDeduplicater   </td><td class="markdownTableBodyLeft">Deduplicate sentence using minhash.<br  />
SentencePiece is used when tokenizing sentences.   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ZeroPunctuationFilter   </td><td class="markdownTableBodyLeft">Remove sentence without punctuation that is "ã€","ï½¤","ã€‚","ï½¡","ï¼",".","ï¼Ÿ","?","ï¼","!".   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PerplexityFilter   </td><td class="markdownTableBodyLeft">KenLM's Perplexity Quality filtering.   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SentenceSegmenter   </td><td class="markdownTableBodyLeft">Execute Rule-based sentence separation (sentence segmentation) using <a href="https://github.com/wwwcojp/ja_sentence_segmenter">ja_sentence_segmenter</a>.   </td><td class="markdownTableBodyLeft">Please refer this <a href="https://qiita.com/heimaru1231/items/b6ed09d4787e4e28175a">article</a>.   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md12"></a>
MultiProcess Cleaning</h1>
<p>In main.cc, we create 8 (fixed value) processes and each process processes a different file to speed it up.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Test</h1>
<p>In this repository, I do test using <a href="https://github.com/google/googletest">GoogleTest</a>. Test folder is tests/, and test file is <a href="./tests/CorpusCleaner_test.cpp">CorpusCleaner_test.cpp</a>.</p>
<p>If you want to do test, Please execute following command.</p>
<div class="fragment"><div class="line"># echo $PWD </div>
<div class="line"># /path/to/corpus-cleanaer/</div>
<div class="line">bash scripts/test.sh</div>
</div><!-- fragment --><p>When you do the command, the results of test is output.</p>
<div class="fragment"><div class="line">+ ./test_corpus_cleaner-googletest</div>
<div class="line">Running main() from /home/corpus-cleaner/tests/build/_deps/googletest-src/googletest/src/gtest_main.cc</div>
<div class="line">[==========] Running 24 tests from 1 test suite.</div>
<div class="line">~ omission ~</div>
<div class="line">[ RUN      ] CorpusCleanerTest.ExceptionReadDocumentFromJsonlOneLine</div>
<div class="line">[       OK ] CorpusCleanerTest.ExceptionReadDocumentFromJsonlOneLine (209 ms)</div>
<div class="line">[----------] 24 tests from CorpusCleanerTest (3140 ms total)</div>
<div class="line"> </div>
<div class="line">[----------] Global test environment tear-down</div>
<div class="line">[==========] 24 tests from 1 test suite ran. (3140 ms total)</div>
<div class="line">[  PASSED  ] 24 tests.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14"></a>
Documentation</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
