<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Corpus Cleaner: Corpus Cleaner</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Corpus Cleaner
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Corpus Cleaner </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md37"></a>
Overview</h1>
<p>Welcome to my repository! <br  />
 This repository is a C++ library includes quality filtering, deduplication, and unnecessary vocabulary removal for Japanese corpus. <br  />
 The features are following.</p>
<ul>
<li><b>Normalizer</b>: Sentence normalization created by <a href="https://github.com/neologd/mecab-ipadic-neologd/wiki/Regexp.ja">mecab-neologd</a></li>
<li><b>URL Remover</b>: Remove URLs matching regular expression</li>
<li><b>Special Characters Remover</b>: Remove certain special characters (‚òÄ, ‚ô°, ‚òÜ, etc.)</li>
<li><b>Emoji Remover</b>: Remove emoji characters that is \U0001F300 to \U0001F9FF.</li>
<li><b>Quotes Remover</b>: Remove quotes ([1], {245})</li>
<li><b>Length Filter</b>: Remove too long sentence and too short sentence</li>
<li><b>Language Filter</b>: Determine whether it is a Japanese document</li>
<li><b>Minhash Deduplicator</b>: Deduplication using Minhash</li>
<li><b>ZeroPunctuationFilter</b>: Delete documents without punctuation</li>
<li><b>Sentence Segmenter</b>: Divide the corpus into sentences based on rules</li>
<li><b>Perplexity Filter</b>: Perplexity filter using kENLM</li>
</ul>
<h1><a class="anchor" id="autotoc_md39"></a>
Getting Started</h1>
<h2><a class="anchor" id="autotoc_md40"></a>
Clone Repository</h2>
<div class="fragment"><div class="line">git clone https://github.com/ce-lery/corpus-cleaner.git</div>
<div class="line">cd corpus-cleaner</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
Install Step</h2>
<h3><a class="anchor" id="autotoc_md42"></a>
Docker</h3>
<p>Build a python environment using Docker files.</p>
<div class="fragment"><div class="line">docker build -t corpus-cleaner-image ./</div>
<div class="line">docker run -v ./:/home/corpus-cleaner/ -it --gpus all corpus-cleaner-image</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md43"></a>
Other (Local Install)</h3>
<div class="fragment"><div class="line">sudo apt upgrade</div>
<div class="line">sudo apt-get install cmake gdb libboost-system-dev libboost-thread-dev libboost-program-options-dev libboost-test-dev libeigen3-dev zlib1g-dev libbz2-dev liblzma-dev  pkg-config  libgoogle-perftools-dev curl wget build-essential nano flex bison</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md44"></a>
Common Step</h2>
<p>Run the shell script with the following command. <br  />
 In this script, you install third party library.</p>
<div class="fragment"><div class="line">bash scripts/setup.sh</div>
</div><!-- fragment --><p>Build source code of corpus-cleaner.</p>
<div class="fragment"><div class="line">bash scripts/build.sh</div>
</div><!-- fragment --><p>Please place the files to be cleaned in "./results/data/original". The file format is ".txt". For example, "wiki.txt", "cc100_train.txt", and so on.</p>
<div class="fragment"><div class="line">mkdir -p results/data/original/</div>
<div class="line"># Please place the files to be cleaned in &quot;./results/data/original&quot;.</div>
</div><!-- fragment --><p>Run corpus_cleaner. Please wait a minute. <br  />
</p>
<div class="fragment"><div class="line">bash scripts/run.sh</div>
</div><!-- fragment --><p>The cleaning result files will be created in "results/data/cleaned". <br  />
 The file format is jsonl. <br  />
</p>
<h1><a class="anchor" id="autotoc_md45"></a>
Specification</h1>
<p>If you want to see this tool's specification and API references, please refer <a class="el" href="md__2home_2corpus-cleaner_2docs_2specification.html">here</a>.</p>
<h1><a class="anchor" id="autotoc_md46"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md47"></a>
Basic Usage</h2>
<p>The basic usage of corpus-cleaner is same as Getting Started.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Select Filtering Feature</h2>
<p>If you want to disable Sentence Segmenter, please set "bool sentence_segment=false", and create instance of <a class="el" href="classCorpusCleaner.html">CorpusCleaner</a> class.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classCorpusCleaner.html">CorpusCleaner</a> corpus_cleaner(input_folder_path,</div>
<div class="line">                             output_folder_path,</div>
<div class="line">                             min_length,</div>
<div class="line">                             max_length,</div>
<div class="line">                             accept_language,</div>
<div class="line">                             store_rejected,</div>
<div class="line">                             execute_sentence_segment, <span class="comment">// &lt;--------- switch here to false</span></div>
<div class="line">                             language_threshold,</div>
<div class="line">                             perplexity_threshold,</div>
<div class="line">                             &amp;generate_dedup_lsh,</div>
<div class="line">                             &amp;deduplicator);</div>
<div class="ttc" id="aclassCorpusCleaner_html"><div class="ttname"><a href="classCorpusCleaner.html">CorpusCleaner</a></div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8hpp_source.html#l00064">corpus_cleaner.hpp:65</a></div></div>
</div><!-- fragment --><p>If you want to disable filter, please Comment out the corresponding filter function in the variable TODO:.</p>
<div class="fragment"><div class="line">int32_t <a class="code hl_function" href="classCorpusCleaner.html#a53c08cd06810612e46afd2b55f845578">CorpusCleaner::CleanPipeline</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Set CorpusCleaner process that will be executed.</span></div>
<div class="line">    <span class="comment">// They will be executed in the order you set them.</span></div>
<div class="line">    vector&lt;void (<a class="code hl_class" href="classCorpusCleaner.html">CorpusCleaner</a>::*)(<a class="code hl_struct" href="struct__DOCUMENT.html">Document</a> &amp;)&gt; cleaner_list = { </div>
<div class="line">        &amp;<a class="code hl_function" href="classCorpusCleaner.html#a028fdb141f2b92da54429677f0abb154">CorpusCleaner::Normalizer</a>,</div>
<div class="line">        &amp;<a class="code hl_function" href="classCorpusCleaner.html#afb2e7e32b845c6d937a6ba39aedbb3ef">CorpusCleaner::URLRemover</a>,</div>
<div class="line">        &amp;<a class="code hl_function" href="classCorpusCleaner.html#a945760c19bee2920cc4410b39d063d9c">CorpusCleaner::EmojiRemover</a>, </div>
<div class="line"><span class="preprocessor">        # &amp;CorpusCleaner::SpecialCharacterRemover,</span></div>
<div class="line"><span class="preprocessor">        # &amp;CorpusCleaner::QuotesRemover,   </span><span class="comment">// &lt;- If you comment or exclude function of </span></div>
<div class="line"><span class="preprocessor">        # &amp;CorpusCleaner::LengthFilter,    </span><span class="comment">// &lt;- cleaner_list, the functions are disabled.</span></div>
<div class="line"><span class="preprocessor">        # &amp;CorpusCleaner::ZeroPunctuationFilter,</span></div>
<div class="line">        &amp;<a class="code hl_function" href="classCorpusCleaner.html#a72054e52aa4d162a33b7069483a6f6be">CorpusCleaner::LanguageFilter</a>,</div>
<div class="line">        &amp;<a class="code hl_function" href="classCorpusCleaner.html#a48075612da853cba90b97e11c92b7c50">CorpusCleaner::MinhashDeduplication</a>,</div>
<div class="line">        &amp;<a class="code hl_function" href="classCorpusCleaner.html#a45f781beefb1ccda6eee48daeee198af">CorpusCleaner::PerplexityFilter</a>,</div>
<div class="line">    }; </div>
<div class="line">    <span class="comment">// ~ ommit ~</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassCorpusCleaner_html_a028fdb141f2b92da54429677f0abb154"><div class="ttname"><a href="classCorpusCleaner.html#a028fdb141f2b92da54429677f0abb154">CorpusCleaner::Normalizer</a></div><div class="ttdeci">void Normalizer(Document &amp;document)</div><div class="ttdoc">Neologd Normalize sentence.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8cpp_source.html#l00540">corpus_cleaner.cpp:540</a></div></div>
<div class="ttc" id="aclassCorpusCleaner_html_a45f781beefb1ccda6eee48daeee198af"><div class="ttname"><a href="classCorpusCleaner.html#a45f781beefb1ccda6eee48daeee198af">CorpusCleaner::PerplexityFilter</a></div><div class="ttdeci">void PerplexityFilter(Document &amp;document)</div><div class="ttdoc">KenLM's Perplexity Quality filtering.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8cpp_source.html#l00331">corpus_cleaner.cpp:331</a></div></div>
<div class="ttc" id="aclassCorpusCleaner_html_a48075612da853cba90b97e11c92b7c50"><div class="ttname"><a href="classCorpusCleaner.html#a48075612da853cba90b97e11c92b7c50">CorpusCleaner::MinhashDeduplication</a></div><div class="ttdeci">void MinhashDeduplication(Document &amp;document)</div><div class="ttdoc">MinHashLSH Deduplication files in the this-&gt;intermediate folder.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8cpp_source.html#l00569">corpus_cleaner.cpp:569</a></div></div>
<div class="ttc" id="aclassCorpusCleaner_html_a53c08cd06810612e46afd2b55f845578"><div class="ttname"><a href="classCorpusCleaner.html#a53c08cd06810612e46afd2b55f845578">CorpusCleaner::CleanPipeline</a></div><div class="ttdeci">int32_t CleanPipeline(void)</div><div class="ttdoc">Pipeline that sequentially executes the configured CorpusCleaner methods.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8cpp_source.html#l00751">corpus_cleaner.cpp:751</a></div></div>
<div class="ttc" id="aclassCorpusCleaner_html_a72054e52aa4d162a33b7069483a6f6be"><div class="ttname"><a href="classCorpusCleaner.html#a72054e52aa4d162a33b7069483a6f6be">CorpusCleaner::LanguageFilter</a></div><div class="ttdeci">void LanguageFilter(Document &amp;document)</div><div class="ttdoc">Language filtering using fastText.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8cpp_source.html#l00365">corpus_cleaner.cpp:365</a></div></div>
<div class="ttc" id="aclassCorpusCleaner_html_a945760c19bee2920cc4410b39d063d9c"><div class="ttname"><a href="classCorpusCleaner.html#a945760c19bee2920cc4410b39d063d9c">CorpusCleaner::EmojiRemover</a></div><div class="ttdeci">void EmojiRemover(Document &amp;document)</div><div class="ttdoc">Remove emoji. For example, ü§ó, üêâ, üìä, and so on.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8cpp_source.html#l00467">corpus_cleaner.cpp:467</a></div></div>
<div class="ttc" id="aclassCorpusCleaner_html_afb2e7e32b845c6d937a6ba39aedbb3ef"><div class="ttname"><a href="classCorpusCleaner.html#afb2e7e32b845c6d937a6ba39aedbb3ef">CorpusCleaner::URLRemover</a></div><div class="ttdeci">void URLRemover(Document &amp;document)</div><div class="ttdoc">Remove URLs matching regular expression.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8cpp_source.html#l00407">corpus_cleaner.cpp:407</a></div></div>
<div class="ttc" id="astruct__DOCUMENT_html"><div class="ttname"><a href="struct__DOCUMENT.html">_DOCUMENT</a></div><div class="ttdoc">Structure for storing statistical information for each process of CorpusCleaner.</div><div class="ttdef"><b>Definition</b> <a href="corpus__cleaner_8hpp_source.html#l00023">corpus_cleaner.hpp:23</a></div></div>
</div><!-- fragment --><p>Maybe, this step will be changed in the future.</p>
<h1><a class="anchor" id="autotoc_md49"></a>
License</h1>
<p>This repository is licensed under the Apache License, Version2.0. <br  />
 Please refer [LICENSE](LICENSE) file.</p>
<h1><a class="anchor" id="autotoc_md50"></a>
Third Party Library</h1>
<p>In this repository, I use following third party library. <br  />
 Please note the lisence. <br  />
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Library   </th><th class="markdownTableHeadLeft">License   </th><th class="markdownTableHeadLeft">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/unicode-org/icu?tab=readme-ov-file">icu</a>   </td><td class="markdownTableBodyLeft"><a href="https://github.com/unicode-org/icu?tab=License-1-ov-file#readme">UNICODE LICENSE V3</a>   </td><td class="markdownTableBodyLeft">For NFKC normalization of Normalizer.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/kpu/kenlm?tab=readme-ov-file">kenlm</a>   </td><td class="markdownTableBodyLeft"><b>LGPL license</b>   </td><td class="markdownTableBodyLeft">For perplexity filtering.<br  />
Since I have not embedded this tool in this repository (installed it when I use it), <br  />
I think that this repository is not covered by the LGPL license.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/google/sentencepiece">SentencePiece</a>   </td><td class="markdownTableBodyLeft">Apache-2.0 license   </td><td class="markdownTableBodyLeft">For tokenization in perplexity filtering.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/rurban/smhasher">smhasher</a>   </td><td class="markdownTableBodyLeft">MIT licensed.   </td><td class="markdownTableBodyLeft">For hash value generation for Mihash processing.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/simdjson/simdjson">simdjson</a>   </td><td class="markdownTableBodyLeft">Apache-2.0 license   </td><td class="markdownTableBodyLeft">For jsonl parsing.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/facebookresearch/fastText">fastText</a>   </td><td class="markdownTableBodyLeft">MIT license   </td><td class="markdownTableBodyLeft">For language filtering.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/google/googletest">GoogleTest</a>   </td><td class="markdownTableBodyLeft">BSD-3-Clause license   </td><td class="markdownTableBodyLeft">For test.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/doxygen/doxygen">doxygen</a>   </td><td class="markdownTableBodyLeft">(GPL-2.0 license)   </td><td class="markdownTableBodyLeft">For Documentation.<br  />
This license does not apply to works produced by doxygen   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md51"></a>
Test</h1>
<div class="fragment"><div class="line">bash scripts/test.sh</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md52"></a>
Contribution</h1>
<p>We welcome your contributions to this repository. To contribute, please see <a class="el" href="md__2home_2corpus-cleaner_2CONTRIBUTING.html">CONTRIBUTING.md</a>.</p>
<h1><a class="anchor" id="autotoc_md53"></a>
TODO</h1>
<h2><a class="anchor" id="autotoc_md54"></a>
ver.0.1.0</h2>
<ul>
<li>[ ] Write document &amp; create doxygen</li>
</ul>
<h2><a class="anchor" id="autotoc_md55"></a>
ver.0.2.0</h2>
<ul>
<li>[ ] Set Github Action's CI/CDÔºàbuildÔºâ</li>
<li>[ ] Implement pybind &amp; python code</li>
<li>[ ] Implement loader json &amp; jsonl</li>
<li>[ ] Morphological analysis (by jagger)</li>
<li>[ ] Remove ad header and footer</li>
<li>[ ] Remove HTML mark</li>
<li>[ ] Implement dump .txt format file(only is_removed=false).</li>
<li>[ ] Remove repeated expressions</li>
</ul>
<h2><a class="anchor" id="autotoc_md56"></a>
ver.0.3.0</h2>
<ul>
<li>[ ] Speedup? </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
